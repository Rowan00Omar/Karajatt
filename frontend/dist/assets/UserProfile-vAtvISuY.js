import{r as s,j as e,L as I,a as f}from"./index-Bcnj4llk.js";import{K as $}from"./key-round-Cf8z0Bqs.js";import{F as O}from"./DocumentTextIcon-Doxb5nvs.js";import{z as g,L as b}from"./dialog-Ci-9zlF2.js";import"./createLucideIcon-Bk6MJNge.js";import"./index-ChClsMVP.js";function U({title:a,titleId:n,...m},d){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":n},m),a?s.createElement("title",{id:n},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"}))}const y=s.forwardRef(U);function B({title:a,titleId:n,...m},d){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":n},m),a?s.createElement("title",{id:n},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 9.75h4.875a2.625 2.625 0 0 1 0 5.25H12M8.25 9.75 10.5 7.5M8.25 9.75 10.5 12m9-7.243V21.75l-3.75-1.5-3.75 1.5-3.75-1.5-3.75 1.5V4.757c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0c1.1.128 1.907 1.077 1.907 2.185Z"}))}const T=s.forwardRef(B);function z({title:a,titleId:n,...m},d){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:d,"aria-labelledby":n},m),a?s.createElement("title",{id:n},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const M=s.forwardRef(z),W=()=>{const[a,n]=s.useState(""),[m,d]=s.useState(""),[N,p]=s.useState(!1),[w,v]=s.useState([]),[k,u]=s.useState(!1),[j,h]=s.useState(null),c=localStorage.getItem("token"),[L,R]=s.useState(null),[P,E]=s.useState(null);s.useEffect(()=>{window.scrollTo(0,0),(async()=>{var l,x;if(c)try{u(!0),h(null);const r=(await f.get("/api/auth/userInfo",{headers:{Authorization:`Bearer ${c}`}})).data;if(r){E(r.id);const o=r.first_name+" "+r.last_name;n(o),d(r.email);const S=await f.get(`/api/auth/orders/passed/${r.id}`,{headers:{Authorization:`Bearer ${c}`}});v(S.data)}}catch(i){console.error("Error fetching data:",i),h(((x=(l=i.response)==null?void 0:l.data)==null?void 0:x.message)||"حدث خطأ في جلب البيانات")}finally{u(!1)}})()},[c]);const C=a.split(" ").map(t=>t[0]).join(""),F=()=>{p(!0)};return k?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsx("div",{className:"min-h-screen bg-white py-0 px-4 flex justify-center",dir:"rtl",children:e.jsxs("div",{className:"w-full max-w-4xl flex flex-col gap-4 sm:gap-8 text-right pt-16 md:pt-20",children:[e.jsxs("div",{className:"bg-white border border-gray-200 shadow-lg rounded-xl p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 sm:mb-6",children:[e.jsx("div",{className:"bg-[#4a60e9] text-white w-10 sm:w-12 h-10 sm:h-12 flex items-center justify-center rounded-full text-base sm:text-lg font-semibold",children:C}),e.jsx("div",{children:e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-[#4a60e9]",children:"بيانات المستخدم"})})]}),e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"الاسم الكامل"}),e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900",children:a})]}),e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"البريد الإلكتروني"}),e.jsx("p",{className:"text-base sm:text-lg font-medium text-gray-900 break-all",children:m})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 mt-4 sm:mt-6",children:[e.jsxs(I,{to:`/reset-forgotten-password/${c}`,className:"w-full sm:w-fit bg-indigo-600 hover:bg-indigo-700 text-white py-2.5 px-4 rounded-lg transition flex items-center justify-center sm:justify-start gap-2 text-sm sm:text-base",children:[e.jsx($,{className:"w-4 sm:w-5 h-4 sm:h-5"}),"تغيير كلمة المرور"]}),e.jsxs("button",{onClick:F,className:"w-full sm:w-fit bg-red-600 hover:bg-red-700 text-white py-2.5 px-4 rounded-lg transition flex items-center justify-center sm:justify-start gap-2 text-sm sm:text-base",children:[e.jsx(M,{className:"w-4 sm:w-5 h-4 sm:h-5"})," حذف الحساب"]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 shadow-lg rounded-xl p-4 sm:p-6 overflow-x-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(T,{className:"w-5 sm:w-6 h-5 sm:h-6 text-[#4a60e9]"}),e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-[#4a60e9]",children:"الطلبات المفحوصة السليمة"})]}),j&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4",children:j}),e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle",children:e.jsxs("table",{className:"min-w-full text-sm text-right",children:[e.jsx("thead",{className:"text-gray-500 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 pr-4 text-xs sm:text-sm font-medium",children:"اسم القطعة"}),e.jsx("th",{className:"py-2 pr-4 text-xs sm:text-sm font-medium",children:"تاريخ الطلب"}),e.jsx("th",{className:"py-2 pr-4 text-xs sm:text-sm font-medium",children:"السعر"}),e.jsx("th",{className:"py-2 text-xs sm:text-sm font-medium",children:"اسم البائع"}),e.jsx("th",{className:"py-2 text-xs sm:text-sm font-medium",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"text-gray-800",children:w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-4 text-gray-500",children:"لا توجد طلبات مفحوصة سليمة"})}):w.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 pr-4 text-xs sm:text-sm",children:t.partName}),e.jsx("td",{className:"py-3 pr-4 text-xs sm:text-sm",children:t.orderDate}),e.jsx("td",{className:"py-3 pr-4 text-xs sm:text-sm",children:t.price}),e.jsx("td",{className:"py-3 text-xs sm:text-sm",children:t.seller}),e.jsx("td",{className:"py-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:async()=>{var l,x;try{const i=await f.get(`/api/auth/orders/${t.id}/report/download`,{headers:{Authorization:`Bearer ${c}`},responseType:"blob"}),r=window.URL.createObjectURL(new Blob([i.data])),o=document.createElement("a");o.href=r,o.setAttribute("download",`inspection_report_${t.id}.pdf`),document.body.appendChild(o),o.click(),o.parentNode.removeChild(o),window.URL.revokeObjectURL(r)}catch(i){console.error("Error downloading report:",i);const r=((x=(l=i.response)==null?void 0:l.data)==null?void 0:x.message)||"فشل في تحميل التقرير";h(r)}},className:"inline-flex items-center px-2 sm:px-3 py-1 border border-transparent text-xs sm:text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 whitespace-nowrap",children:[e.jsx(O,{className:"h-3 sm:h-4 w-3 sm:w-4 ml-1"}),"تقرير الفحص"]}),t.inspectorPhone&&(L===t.id?e.jsxs("span",{className:"inline-flex items-center px-2 sm:px-3 py-1 border border-transparent text-xs sm:text-sm leading-4 font-medium rounded-md text-green-700 bg-green-100 whitespace-nowrap",children:[e.jsx(y,{className:"h-3 sm:h-4 w-3 sm:w-4 ml-1"}),t.inspectorPhone]}):e.jsx("button",{type:"button",onClick:()=>R(t.id),className:"inline-flex items-center px-2 sm:px-3 py-1 border border-transparent text-xs sm:text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 whitespace-nowrap",children:e.jsx(y,{className:"h-3 sm:h-4 w-3 sm:w-4 ml-1"})}))]})})]},t.uniqueKey))})]})})})]}),e.jsx(g,{appear:!0,show:N,as:s.Fragment,children:e.jsxs(b,{as:"div",className:"relative z-10",onClose:()=>p(!1),children:[e.jsx(g.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsx(g.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(b.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-right shadow-xl transition-all",children:[e.jsx(b.Title,{className:"text-lg font-medium text-gray-900",children:"هل أنت متأكد من حذف الحساب؟"}),e.jsx("div",{className:"mt-4 text-sm text-gray-500",children:"سيتم حذف حسابك نهائيًا ولا يمكن استعادته."}),e.jsxs("div",{className:"mt-6 flex gap-3 justify-end",children:[e.jsx("button",{className:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg text-sm",onClick:()=>p(!1),children:"إلغاء"}),e.jsx("button",{className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm",onClick:async()=>{var t,l;p(!1);try{u(!0),h(null),await f.delete("/api/auth/me",{headers:{Authorization:`Bearer ${c}`}}),localStorage.removeItem("token"),localStorage.removeItem("userRole"),window.location.href="/"}catch(x){h(((l=(t=x.response)==null?void 0:t.data)==null?void 0:l.message)||"فشل في حذف الحساب. حاول مرة أخرى.")}finally{u(!1)}},children:"نعم، احذف"})]})]})})})]})})]})})};export{W as default};
