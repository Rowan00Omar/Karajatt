import{c as D,u as S,r as c,j as e,a as j}from"./index-diZV0YSE.js";import{I as o}from"./Input-BlMH5Tx_.js";import{B as q}from"./Button-rsidKKBk.js";import{H as I}from"./Helmet-DBvIfVxX.js";import{X as k}from"./x-DuQ7D31F.js";import{c as E}from"./createLucideIcon-Cq23c9UE.js";/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],U=E("arrow-right",B),O=()=>{const d=D(),_=S(),[u,x]=c.useState(!1),[g,f]=c.useState(""),[A,v]=c.useState(null),[a,p]=c.useState({first_name:"",last_name:"",email:"",phone_number:"",apartment:"",floor:"",street:"",building:"",shipping_method:"PKG",postal_code:"",city:"Riyadh",country:"SA",state:"Riyadh"});c.useEffect(()=>{(async()=>{try{const s=localStorage.getItem("token");if(!s){d("/login");return}const r=await j.get("/api/auth/userInfo",{headers:{Authorization:`Bearer ${s}`}});v(r.data),p(t=>({...t,first_name:r.data.first_name||"",last_name:r.data.last_name||"",email:r.data.email||"",phone_number:r.data.phone_number||""}))}catch{d("/login")}})()},[d]);const n=m=>{const{name:s,value:r}=m.target;if(s==="phone_number"){let t=r.replace(/\D/g,"");t.startsWith("966")||(t.startsWith("0")&&(t=t.substring(1)),t.startsWith("966")||(t="+966"+t)),p(h=>({...h,[s]:t}))}else p(t=>({...t,[s]:r}))},N=async m=>{var s,r,t,h,y;m.preventDefault(),x(!0),f("");try{const l=localStorage.getItem("token"),b=(s=_.state)==null?void 0:s.cartData;if(!b)throw new Error("لم يتم العثور على بيانات السلة");const C={...a,phone_number:a.phone_number.startsWith("+966")?a.phone_number:"+966"+a.phone_number},i=await j.post("/api/payments/checkout",{...b,billingData:C},{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}});if(i.data.success&&i.data.paymentUrl)localStorage.setItem("currentOrderId",i.data.orderId),window.location.href=i.data.paymentUrl;else throw new Error(i.data.error||"فشل في بدء عملية الدفع")}catch(l){console.error("خطأ في الدفع:",{error:((t=(r=l.response)==null?void 0:r.data)==null?void 0:t.error)||l.message,timestamp:new Date().toISOString()}),f(((y=(h=l.response)==null?void 0:h.data)==null?void 0:y.error)||l.message||"حدث خطأ")}finally{x(!1)}},w=()=>{d(-1)};return e.jsxs(e.Fragment,{children:[e.jsx(I,{children:e.jsx("title",{children:"الفاتورة"})}),e.jsx("div",{className:"fixed inset-0 flex flex-col justify-center items-center bg-gray-900/30 backdrop-blur-md px-4 py-12 sm:px-6 lg:px-8",children:e.jsx("div",{className:"w-full max-w-2xl relative",children:e.jsxs("div",{className:"bg-white py-8 px-4 shadow-2xl sm:rounded-2xl sm:px-10",children:[e.jsx("button",{onClick:w,className:"absolute top-4 left-4 text-gray-400 hover:text-gray-500 transition-colors",children:e.jsx(k,{className:"w-6 h-6"})}),e.jsxs("form",{onSubmit:N,className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"معلومات الفواتير"}),e.jsx("p",{className:"text-gray-600",children:"يرجى إدخال معلومات الفواتير الخاصة بك للمتابعة"})]}),g&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg",children:g}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"المعلومات الشخصية"}),e.jsx(o,{type:"text",name:"first_name",placeholder:"الاسم الأول",value:a.first_name,onChange:n,required:!0}),e.jsx(o,{type:"text",name:"last_name",placeholder:"الاسم الأخير",value:a.last_name,onChange:n,required:!0}),e.jsx(o,{type:"email",name:"email",placeholder:"البريد الإلكتروني",value:a.email,onChange:n,required:!0}),e.jsx(o,{type:"tel",name:"phone_number",placeholder:"رقم الهاتف",value:a.phone_number,onChange:n,required:!0}),e.jsx("p",{className:"text-sm text-gray-500",children:"سيتم إضافة رمز الدولة +966 تلقائياً"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"معلومات العنوان"}),e.jsx(o,{type:"text",name:"street",placeholder:"الشارع",value:a.street,onChange:n,required:!0}),e.jsx(o,{type:"text",name:"building",placeholder:"رقم المبنى",value:a.building,onChange:n,required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{type:"text",name:"apartment",placeholder:"الشقة",value:a.apartment,onChange:n,required:!0}),e.jsx(o,{type:"text",name:"floor",placeholder:"الطابق",value:a.floor,onChange:n,required:!0})]}),e.jsx(o,{type:"text",name:"postal_code",placeholder:"الرمز البريدي",value:a.postal_code,onChange:n,required:!0})]})]}),e.jsxs(q,{type:"submit",className:"w-full flex justify-center items-center gap-2 py-3 px-4 border border-transparent rounded-lg shadow-sm text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors",disabled:u,children:[u?"جاري المعالجة...":"المتابعة إلى الدفع",!u&&e.jsx(U,{className:"w-5 h-5"})]})]})]})})})]})};export{O as default};
