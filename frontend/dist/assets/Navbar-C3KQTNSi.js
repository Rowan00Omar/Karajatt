import{b as D,r as a,c as J,j as e,a as W,L as g}from"./index-BrhSUNsT.js";import{B as X}from"./Button-C-CX7OgO.js";import{X as R}from"./x-DBxqpYZo.js";import{S as $}from"./shopping-cart-CSJS0DH3.js";import{u as G,U as B,L}from"./useLogout-DYUGBv2F.js";import{L as O}from"./LogoNoBack-DewmKgZJ.js";import{S as P}from"./shopping-bag-DyD2rTwF.js";import{H as Q}from"./house-C8F_FTZB.js";import"./createLucideIcon-uN1KLFjf.js";const V=({onClose:l})=>{const{cartItems:s,removeFromCart:x,subtotal:c,cartTotal:i,discount:n,discountOnSubtotal:p,discountOnInspection:j,appliedCoupon:h,applyCoupon:q,removeCoupon:T,totalInspectionFees:b,inspectionFee:U,setInspectionFee:N}=D(),[u,y]=a.useState(""),[v,m]=a.useState(""),[w,H]=a.useState(null),[C,k]=a.useState(!1),[F,f]=a.useState(null),A=J();a.useEffect(()=>{(async()=>{try{const o=await W.get("/api/inspection/fee");o.data&&o.data.fee!==void 0&&N(o.data.fee)}catch(o){console.error("Error fetching inspection fee:",o),N(49),H(null)}})()},[]);const S=i,K=async()=>{var t,o,I,_;try{if(k(!0),f(null),!localStorage.getItem("token"))throw new Error("يرجى تسجيل الدخول للمتابعة");const E={cartItems:s.map(r=>({product_id:r.product_id||r.id,name:r.title||r.part_name||"Product",amount_cents:Math.round(parseFloat(r.price)*100),description:r.description||r.title||r.part_name||"Product Description",quantity:r.quantity||1,price:r.price})),amount:S,inspectionFees:b,appliedCoupon:h?{code:h.code,discount:n}:null};localStorage.setItem("checkoutCartData",JSON.stringify(E)),A("/billing",{state:{cartData:E}})}catch(d){d.code==="ERR_NETWORK"?f("لا يمكن الاتصال بالخادم. يرجى التحقق من اتصال الإنترنت الخاص بك والمحاولة مرة أخرى."):f(((o=(t=d.response)==null?void 0:t.data)==null?void 0:o.error)||((_=(I=d.response)==null?void 0:I.data)==null?void 0:_.message)||d.message||"فشلت عملية الدفع. يرجى المحاولة مرة أخرى.")}finally{k(!1)}},M=async()=>{if(!u.trim()){m("Please enter a coupon code");return}const t=await q(u);t.success?(m(""),y("")):m(t.error)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-end p-4 pointer-events-none",children:e.jsxs("div",{className:`bg-white shadow-2xl rounded-2xl overflow-hidden transition-all duration-300 pointer-events-auto relative flex flex-col
          ${s.length>0?"w-96 h-[85vh]":"w-80 h-72"}`,dir:"rtl",children:[e.jsxs("div",{className:"p-6 border-b bg-white z-10 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-babyJanaBlue",children:"سلة التسوق"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(R,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:s.length===0?e.jsx("div",{className:"p-8 text-center h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"سلة التسوق فارغة"})}):e.jsx("div",{className:"p-6 space-y-4",children:s.map(t=>e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 flex gap-4 items-center relative group",children:[e.jsx("div",{className:"w-16 h-16 flex-shrink-0",children:e.jsx("img",{src:t.image_url||"/placeholder.jpg",alt:t.title||t.part_name,className:"w-full h-full object-cover rounded-lg"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx("h3",{className:"font-medium text-babyJanaBlue truncate",children:t.title||t.part_name}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[(parseFloat(t.price)||0).toFixed(2)," ر.س"]}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:["رسوم الفحص: ",U," ر.س"]})]}),e.jsx("button",{onClick:()=>x(t.id),className:"absolute top-2 left-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all duration-200",children:e.jsx(R,{size:18})})]},t.id))})}),s.length>0&&e.jsxs("div",{className:"border-t bg-white p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:t=>y(t.target.value),placeholder:"أدخل رمز الكوبون",className:"flex-1 border rounded-lg p-2.5 text-sm text-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"}),e.jsx("button",{onClick:M,className:"bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition-colors",children:"تطبيق"})]}),v&&e.jsx("p",{className:"text-red-500 text-sm",children:v}),h&&e.jsxs("div",{className:"flex justify-between items-center bg-green-50 p-3 rounded-lg text-sm",children:[e.jsxs("span",{className:"text-green-700",children:["تم تطبيق الكوبون: ",h.code]}),e.jsx("button",{onClick:T,className:"text-red-500 hover:text-red-700 transition-colors",children:"إزالة"})]})]}),e.jsxs("div",{className:"space-y-3 bg-gray-50 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"المجموع الفرعي:"}),e.jsxs("span",{children:[c.toFixed(2)," ر.س"]})]}),p>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"خصم على المنتجات:"}),e.jsxs("span",{children:["- ",p.toFixed(2)," ر.س"]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"رسوم الفحص:"}),e.jsxs("span",{children:[b.toFixed(2)," ر.س"]})]}),j>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"خصم على رسوم الفحص:"}),e.jsxs("span",{children:["- ",j.toFixed(2)," ر.س"]})]}),w&&e.jsx("p",{className:"text-red-500 text-xs text-right",children:w}),e.jsxs("div",{className:"flex justify-between font-bold text-lg text-babyJanaBlue pt-2 border-t",children:[e.jsx("span",{children:"المجموع:"}),e.jsxs("span",{children:[S.toFixed(2)," ر.س"]})]})]}),F&&e.jsx("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg text-sm",children:F}),e.jsx(X,{onClick:K,disabled:C,className:"w-full py-3 text-sm font-medium rounded-xl disabled:opacity-50 disabled:cursor-not-allowed",children:C?"جاري المعالجة...":"اتمام الشراء"})]})]})})},z=()=>{const[l,s]=a.useState(!1),{cartItems:x}=D(),c=x.reduce((i,n)=>i+n.quantity,0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>s(!0),className:"p-2  text-gray-400 hover:text-white cursor-pointer",children:e.jsx($,{className:"w-6 h-6"})}),c>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:c})]}),l&&e.jsx(V,{onClose:()=>s(!1)})]})},ce=()=>{const l=G(),s=J(),[x,c]=a.useState(null);a.useEffect(()=>{const n=localStorage.getItem("userRole");c(n)},[]);const i=n=>{if(n.preventDefault(),!localStorage.getItem("userRole")){s("/login");return}s("/user/profile")};return e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"hidden md:flex fixed justify-between bg-gradient-to-b from-gray-900 to-gray-800 items-center top-0 left-0 right-0 w-full px-6 py-4 z-40 border-b border-gray-700",children:[e.jsx("div",{className:"w-[144px]"}),x?e.jsx(g,{to:"/user",className:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx("img",{src:O,alt:"",className:"h-16 w-auto transition-all hover:scale-105 hover:brightness-110 filter drop-shadow-[0_0_8px_rgba(255,255,255,0.15)]"})}):e.jsx(g,{to:"/",className:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx("img",{src:O,alt:"",className:"h-16 w-auto transition-all hover:scale-105 hover:brightness-110 filter drop-shadow-[0_0_8px_rgba(255,255,255,0.15)]"})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>s("/search"),className:"text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:e.jsx(P,{className:"w-6 h-6"})}),e.jsx("div",{className:"text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:e.jsx(z,{})}),e.jsx("button",{onClick:i,className:"text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:e.jsx(B,{className:"w-6 h-6"})}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:e.jsx(L,{className:"w-6 h-6"})})]})]}),e.jsx("nav",{className:"md:hidden fixed bottom-0 left-0 right-0 w-full shadow-lg border-t border-gray-700 z-50 bg-gradient-to-t from-gray-900 to-gray-800",children:e.jsxs("div",{className:"flex justify-around items-center h-16",children:[e.jsxs(g,{to:"/",className:"flex flex-col items-center text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:[e.jsx(Q,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"الرئيسية"})]}),e.jsxs("button",{onClick:()=>s("/search"),className:"flex flex-col items-center text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:[e.jsx(P,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"المنتجات"})]}),e.jsxs("div",{className:"flex flex-col items-center text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:[e.jsx(z,{}),e.jsx("span",{className:"text-xs mt-1",children:"السلة"})]}),e.jsxs("button",{onClick:i,className:"flex flex-col items-center text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:[e.jsx(B,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"حسابي"})]}),e.jsxs("button",{onClick:l,className:"flex flex-col items-center text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:[e.jsx(L,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"تسجيل خروج"})]})]})})]})};export{ce as default};
