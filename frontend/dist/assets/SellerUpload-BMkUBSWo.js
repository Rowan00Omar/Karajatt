import{j as e,r as t,a as B}from"./index-Dn0qhe6D.js";import{B as re}from"./Button-BtIySsyH.js";import{S as h,a as l}from"./Select-DaGhvfuB.js";import{I as p}from"./Input-CPFVIBKQ.js";function le({children:i,className:m="",...n}){return e.jsx("div",{className:`bg-white shadow-md rounded-lg ${m}`,...n,children:i})}function ne({children:i,className:m="",...n}){return e.jsx("div",{className:`p-4 ${m}`,...n,children:i})}const oe=["مقبولة","جيدة","جيدة جدا","ممتازة"],ie={manufacturer:"الماركة",model:"نوع السيارة",startYear:"سنة البداية",endYear:"سنة النهاية",category:"النوع",part:"القطعة",status:"الحالة",title:"عنوان الاعلان",price:"السعر",condition:"حالة الاستخدام",id:"المعرف"},me=()=>{const[i,m]=t.useState({manufacturers:[],modelsByManufacturer:{},categories:[],partsByCategory:{},yearsByModel:{}}),[n,k]=t.useState(""),[v,D]=t.useState(""),[g,M]=t.useState(""),[x,Y]=t.useState(""),[c,U]=t.useState(""),[j,E]=t.useState(""),[d,y]=t.useState([]),[N,F]=t.useState(""),[w,V]=t.useState(""),[A,$]=t.useState(""),[z,q]=t.useState(""),[S,L]=t.useState(""),[C,P]=t.useState(""),[R,K]=t.useState(null),[T,f]=t.useState(!1),[H,O]=t.useState(""),[W,o]=t.useState("");t.useEffect(()=>{(async()=>{const r=localStorage.getItem("token");if(r)try{const u=await B.get("/api/auth/userInfo",{headers:{Authorization:`Bearer ${r}`}});K(u.data.id)}catch(u){console.error("Failed to fetch user role",u)}})()},[]),t.useEffect(()=>{(async()=>{try{f(!0);const r=await B.get("/api/filtering/unified-data");m(r.data)}catch(r){console.error("Failed to fetch unified data:",r)}finally{f(!1)}})()},[]);const Q=a=>{const r=Array.from(a.target.files);if(r.length+d.length>4){alert("لا تستطيع رفع اكثر من 4 صور");return}y([...d,...r])},X=async a=>{var _,G;a.preventDefault();const u=Object.entries({manufacturer:n,model:v,startYear:g,endYear:x,category:c,part:j,status:N,title:w,price:S,condition:C,id:R}).filter(([s,b])=>!b).map(([s])=>ie[s]);if(u.length>0){o(`الحقول التالية مطلوبة: ${u.join("، ")}`);return}if(Number(g)>Number(x)){o("سنة البداية يجب أن تكون أقل من أو تساوي سنة النهاية");return}if(d.length===0){o("يرجى اختيار صورة واحدة على الأقل");return}try{f(!0),o(""),O("");const s=new FormData;s.append("manufacturer",n),s.append("model",v),s.append("startYear",g),s.append("endYear",x),s.append("category",c),s.append("part",j),s.append("status",N),s.append("title",w),s.append("extraDetails",A),s.append("timeInStock",z),s.append("price",S),s.append("condition",C),s.append("id",R);for(let I=0;I<d.length;I++)s.append("images",d[I]);const b=localStorage.getItem("token");if(!b){o("يرجى تسجيل الدخول أولاً");return}const J=await B.post("/api/seller/upload",s,{headers:{Authorization:`Bearer ${b}`,"Content-Type":"multipart/form-data"}});J.status===201&&(y(J.data.images),O("تم رفع المنتج بنجاح!"),o(""),te())}catch(s){console.error("فشل في رفع المنتج:",s),s.response?(console.error("تفاصيل خطأ الخادم:",{status:s.response.status,data:s.response.data,headers:s.response.headers}),o(`خطأ في الخادم: ${((_=s.response.data)==null?void 0:_.message)||((G=s.response.data)==null?void 0:G.error)||"حدث خطأ أثناء رفع القطعة"}`)):s.request?(console.error("لم يتم استلام رد من الخادم:",s.request),o("لم يتم استلام رد من الخادم. يرجى التحقق من اتصالك بالإنترنت")):(console.error("خطأ في إعداد الطلب:",s.message),o("حدث خطأ أثناء إعداد الطلب"))}finally{f(!1)}},Z=a=>{const r=a.target.value;M(r)},ee=a=>{const r=a.target.value;Y(r)},ae=()=>n?i.modelsByManufacturer[n]||[]:[],se=()=>c?i.partsByCategory[c]||[]:[],te=()=>{k(""),D(""),M(""),Y(""),U(""),E(""),y([]),F(""),V(""),$(""),q(""),L(""),P("")};return e.jsx("div",{className:"min-h-[90%] bg-gray-50 py-0 px-4 sm:px-6 lg:px-8",children:e.jsx(le,{className:"max-w-7xl mx-auto shadow-xl rounded-lg overflow-hidden",children:e.jsxs(ne,{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"رفع قطعة جديدة"}),e.jsx("p",{className:"text-gray-600",children:"قم بملء التفاصيل التالية لرفع قطعة جديدة"})]}),H&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-2 rounded-lg",children:H}),W&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-2 rounded-lg",children:W}),e.jsxs("form",{onSubmit:X,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4 md:col-span-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 border-b pb-2",children:"المعلومات الأساسية"}),e.jsx(p,{type:"text",placeholder:"ادخل عنوان الاعلان",value:w,onChange:a=>V(a.target.value),className:"w-full transition-all duration-200 hover:border-blue-400 focus:ring-2 focus:ring-blue-400"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 border-b pb-2",children:"معلومات السيارة"}),e.jsxs(h,{onValueChange:k,value:n,className:"w-full transition-all duration-200 hover:border-blue-400",children:[e.jsx(l,{disabled:!0,value:"",children:"اختر الماركة"}),i.manufacturers.map(a=>e.jsx(l,{value:a,children:a},a))]}),n?e.jsxs(h,{onValueChange:D,value:v,className:"w-full transition-all duration-200 hover:border-blue-400",children:[e.jsx(l,{disabled:!0,value:"",children:"اختر نوع السيارة"}),ae().map(a=>e.jsx(l,{value:a,children:a},a))]}):e.jsx("div",{className:"w-full h-[40px] border border-gray-200 rounded-md bg-gray-50 opacity-50"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{type:"number",placeholder:"سنة البداية",value:g,onChange:Z,className:"w-full transition-all duration-200 hover:border-blue-400 focus:ring-2 focus:ring-blue-400"}),e.jsx(p,{type:"number",placeholder:"سنة النهاية",value:x,onChange:ee,className:"w-full transition-all duration-200 hover:border-blue-400 focus:ring-2 focus:ring-blue-400"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 border-b pb-2",children:"معلومات القطعة"}),e.jsxs(h,{onValueChange:U,value:c,className:"w-full transition-all duration-200 hover:border-blue-400",children:[e.jsx(l,{disabled:!0,value:"",children:"اختر النوع"}),i.categories.map(a=>e.jsx(l,{value:a,children:a},a))]}),c&&e.jsxs(h,{onValueChange:E,value:j,className:"w-full transition-all duration-200 hover:border-blue-400",children:[e.jsx(l,{disabled:!0,value:"",children:"اختر القطعة"}),se().map(a=>e.jsx(l,{value:a,children:a},a))]}),e.jsxs(h,{onValueChange:P,value:C,className:"w-full transition-all duration-200 hover:border-blue-400",children:[e.jsx(l,{disabled:!0,value:"",children:"حالة الاستخدام"}),e.jsx(l,{value:"مجددة",children:"مجددة"}),e.jsx(l,{value:"مستعملة",children:"مستعملة"})]}),e.jsxs(h,{onValueChange:F,value:N,className:"w-full transition-all duration-200 hover:border-blue-400",children:[e.jsx(l,{disabled:!0,value:"",children:"اختر الحالة"}),oe.map(a=>e.jsx(l,{value:a,children:a},a))]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 border-b pb-2",children:"السعر والمخزون"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{type:"number",placeholder:"ادخل السعر",value:S,onChange:a=>L(a.target.value),className:"w-full transition-all duration-200 hover:border-blue-400 focus:ring-2 focus:ring-blue-400"}),e.jsx(p,{type:"number",placeholder:"مدة التخزين",value:z,onChange:a=>q(a.target.value),className:"w-full transition-all duration-200 hover:border-blue-400 focus:ring-2 focus:ring-blue-400"})]}),e.jsx("textarea",{placeholder:"تفاصيل إضافية",value:A,onChange:a=>$(a.target.value),className:"w-full p-3 border rounded-md transition-all duration-200 hover:border-blue-400 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 min-h-[80px]"})]}),e.jsxs("div",{className:"space-y-4 md:col-span-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 border-b pb-2",children:"الصور"}),e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("label",{className:"w-full flex flex-col items-center px-4 py-4 bg-white text-blue rounded-lg shadow-lg tracking-wide uppercase border border-blue cursor-pointer hover:bg-blue-50 transition-all duration-200",children:[e.jsx("svg",{className:"w-8 h-8 text-blue-500",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M16.88 9.1A4 4 0 0 1 16 17H5a5 5 0 0 1-1-9.9V7a3 3 0 0 1 4.52-2.59A4.98 4.98 0 0 1 17 8c0 .38-.04.74-.12 1.1zM11 11h3l-4-4-4 4h3v3h2v-3z"})}),e.jsx("span",{className:"mt-2 text-base leading-normal",children:"اختر الصور"}),e.jsx("input",{id:"imageUpload",type:"file",accept:"image/*",multiple:!0,onChange:Q,className:"hidden"})]})}),d.length>0&&e.jsx("div",{className:"grid grid-cols-4 gap-4",children:d.map((a,r)=>e.jsx("div",{className:"relative group",children:e.jsx("div",{className:"aspect-w-1 aspect-h-1 w-full overflow-hidden rounded-lg bg-gray-200",children:e.jsx("img",{src:URL.createObjectURL(a),alt:`img-${r}`,className:"object-cover w-full h-full"})})},r))})]})]}),e.jsx("div",{className:"flex justify-center pt-0",children:e.jsx(re,{type:"submit",disabled:T,className:"w-full sm:w-auto px-8 py-0 text-lg font-medium transition-all duration-200 transform hover:scale-105",children:T?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"جارٍ الرفع..."]}):"رفع القطعة"})})]})]})})})};export{me as default};
