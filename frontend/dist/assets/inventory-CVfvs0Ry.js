import{r as i,a as b,j as e}from"./index-D16p3XyI.js";import{H as w}from"./Helmet-Ddbi4KVR.js";import{C as S}from"./calendar-Doy9eW1W.js";import{P as k}from"./package-CdIsni2H.js";import{S as D}from"./shopping-bag-BdGHPqyt.js";import{T}from"./trending-up-3dicKz7g.js";import{R as A,C as E,X as F,Y as C,T as I}from"./generateCategoricalChart-BXA3Vt3O.js";import{A as P,a as Y}from"./AreaChart-CvgOsHds.js";import"./createLucideIcon-OCKor7qf.js";import"./clsx-B-dksMZM.js";import"./tiny-invariant-CopsF_GD.js";function z(){const[o,p]=i.useState({totalStock:0,stockTrend:"0%",newProducts:0,productsTrend:"0%",inventoryMovement:[]}),[j,d]=i.useState(!0),[m,x]=i.useState(null),[l,u]=i.useState(new Date().getFullYear());i.useEffect(()=>{f()},[l]);const f=async()=>{var t,r,a;try{const s=localStorage.getItem("token");if(!s){x("No authentication token found. Please log in."),d(!1);return}const n=await b.get("/api/admin/stats/inventory",{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(n.data){const h=[],v=((t=n.data.inventoryMovement[0])==null?void 0:t.date)||new Date().toISOString().slice(0,7);for(let c=1;c<=12;c++){const N=c.toString().padStart(2,"0"),g=`${l}-${N}`;h.push({name:g,value:g===v&&n.data.totalStock||0})}p({totalStock:n.data.totalStock||0,stockTrend:n.data.stockTrend||"0%",newProducts:n.data.newProducts||0,productsTrend:n.data.productsTrend||"0%",inventoryMovement:h})}d(!1)}catch(s){console.error("Error fetching inventory data:",s),x(((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to fetch inventory data. Please check your connection and try again."),d(!1)}};return j?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):m?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsxs("div",{className:"text-red-600 text-center",children:[e.jsx("p",{className:"text-xl font-semibold mb-2",children:"خطأ"}),e.jsx("p",{children:m})]})}):e.jsxs(e.Fragment,{children:[e.jsx(w,{children:e.jsx("title",{children:"المخزون والمنتجات"})}),e.jsxs("div",{className:"animate-fadeIn p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"المخزون والمنتجات"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"تحليل حركة المخزون والمنتجات"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg border border-gray-200 px-3 py-2",children:[e.jsx(S,{className:"h-5 w-5 text-gray-400"}),e.jsx("select",{value:l,onChange:t=>u(Number(t.target.value)),className:"border-0 py-1 text-gray-900 focus:ring-0 text-sm",children:[...Array(5)].map((t,r)=>{const a=new Date().getFullYear()-r;return e.jsx("option",{value:a,children:a},a)})})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3 mb-8",children:[e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-indigo-50 rounded-lg",children:e.jsx(k,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"إجمالي المخزون"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.totalStock.toLocaleString("ar-SA")})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-50 rounded-lg",children:e.jsx(D,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"المنتجات الجديدة"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.newProducts.toLocaleString("ar-SA")})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-yellow-50 rounded-lg",children:e.jsx(T,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"نمو المخزون"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.stockTrend})]})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:"حركة المخزون"}),o.inventoryMovement.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"لا توجد بيانات متاحة للفترة المحددة"})}):e.jsx("div",{className:"h-[300px]",children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(P,{data:o.inventoryMovement,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorInventory",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#4F46E5",stopOpacity:.1}),e.jsx("stop",{offset:"95%",stopColor:"#4F46E5",stopOpacity:0})]})}),e.jsx(E,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),e.jsx(F,{dataKey:"name",tickFormatter:t=>{try{const[r,a]=t.split("-"),s=new Date(r,parseInt(a)-1);return isNaN(s.getTime())?t:new Intl.DateTimeFormat("ar",{month:"long",calendar:"gregory"}).format(s)}catch(r){return console.error("Date parsing error:",r),t}},stroke:"#6B7280"}),e.jsx(C,{stroke:"#6B7280",tickFormatter:t=>t.toLocaleString("ar-SA")}),e.jsx(I,{formatter:t=>[t.toLocaleString("ar-SA"),"المخزون"],labelFormatter:t=>{try{const r=new Date(t);return isNaN(r.getTime())?t:new Intl.DateTimeFormat("ar",{year:"numeric",month:"long",day:"numeric",calendar:"gregory"}).format(r)}catch(r){return console.error("Date parsing error:",r),t}},contentStyle:{textAlign:"right",direction:"rtl"}}),e.jsx(Y,{type:"monotone",dataKey:"value",stroke:"#4F46E5",strokeWidth:2,fill:"url(#colorInventory)"})]})})})]})]})]})}export{z as default};
