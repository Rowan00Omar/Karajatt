import{b as z,r,c as O,j as e,a as A,L as g}from"./index-CUFY-AzF.js";import{B as M}from"./Button-CAn6Xsmy.js";import{X as I}from"./x-CHgyoSce.js";import{S as W}from"./shopping-cart-ma3j6CfU.js";import{u as X,U as _,L}from"./useLogout-BuwDieEy.js";import{L as R}from"./LogoNoBack-DewmKgZJ.js";import{S as B}from"./shopping-bag-BK9ol4Bc.js";import{H as $}from"./house-DCK2jk8x.js";import"./createLucideIcon-CE2DkWhp.js";const G=({onClose:l})=>{const{cartItems:s,removeFromCart:x,subtotal:i,cartTotal:c,discount:a,appliedCoupon:d,applyCoupon:q,removeCoupon:D}=z(),[p,j]=r.useState(""),[b,m]=r.useState(""),[N,y]=r.useState(49),[v,J]=r.useState(null),[w,C]=r.useState(!1),[k,u]=r.useState(null),K=O();r.useEffect(()=>{(async()=>{try{const o=await A.get("/api/inspection/fee");o.data&&o.data.fee!==void 0&&y(o.data.fee)}catch(o){console.error("Error fetching inspection fee:",o),y(49),J(null)}})()},[]);const f=s.length*N,F=c+f,T=async()=>{var t,o,S,E;try{if(C(!0),u(null),!localStorage.getItem("token"))throw new Error("يرجى تسجيل الدخول للمتابعة");const H=s.map(n=>({name:n.title||n.part_name||"Product",amount_cents:Math.round(parseFloat(n.price)*100),description:n.description||n.title||n.part_name||"Product Description",quantity:n.quantity||1}));K("/billing",{state:{cartData:{cartItems:H,amount:F,inspectionFees:f,appliedCoupon:d?{code:d.code,discount:a}:null}}})}catch(h){h.code==="ERR_NETWORK"?u("لا يمكن الاتصال بالخادم. يرجى التحقق من اتصال الإنترنت الخاص بك والمحاولة مرة أخرى."):u(((o=(t=h.response)==null?void 0:t.data)==null?void 0:o.error)||((E=(S=h.response)==null?void 0:S.data)==null?void 0:E.message)||h.message||"فشلت عملية الدفع. يرجى المحاولة مرة أخرى.")}finally{C(!1)}},U=async()=>{if(!p.trim()){m("Please enter a coupon code");return}const t=await q(p);t.success?(m(""),j("")):m(t.error)};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-end p-4 pointer-events-none",children:e.jsxs("div",{className:`bg-white shadow-2xl rounded-2xl overflow-hidden transition-all duration-300 pointer-events-auto relative flex flex-col
          ${s.length>0?"w-96 h-[85vh]":"w-80 h-72"}`,dir:"rtl",children:[e.jsxs("div",{className:"p-6 border-b bg-white z-10 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-babyJanaBlue",children:"سلة التسوق"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(I,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:s.length===0?e.jsx("div",{className:"p-8 text-center h-full flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"سلة التسوق فارغة"})}):e.jsx("div",{className:"p-6 space-y-4",children:s.map(t=>e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 flex gap-4 items-center relative group",children:[e.jsx("div",{className:"w-16 h-16 flex-shrink-0",children:e.jsx("img",{src:t.image_url||"/placeholder.jpg",alt:t.title||t.part_name,className:"w-full h-full object-cover rounded-lg"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx("h3",{className:"font-medium text-babyJanaBlue truncate",children:t.title||t.part_name}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[(parseFloat(t.price)||0).toFixed(2)," ر.س"]}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1",children:["رسوم الفحص: ",N," ر.س"]})]}),e.jsx("button",{onClick:()=>x(t.id),className:"absolute top-2 left-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all duration-200",children:e.jsx(I,{size:18})})]},t.id))})}),s.length>0&&e.jsxs("div",{className:"border-t bg-white p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:p,onChange:t=>j(t.target.value),placeholder:"أدخل رمز الكوبون",className:"flex-1 border rounded-lg p-2.5 text-sm text-gray-600 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"}),e.jsx("button",{onClick:U,className:"bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition-colors",children:"تطبيق"})]}),b&&e.jsx("p",{className:"text-red-500 text-sm",children:b}),d&&e.jsxs("div",{className:"flex justify-between items-center bg-green-50 p-3 rounded-lg text-sm",children:[e.jsxs("span",{className:"text-green-700",children:["تم تطبيق الكوبون: ",d.code]}),e.jsx("button",{onClick:D,className:"text-red-500 hover:text-red-700 transition-colors",children:"إزالة"})]})]}),e.jsxs("div",{className:"space-y-3 bg-gray-50 p-4 rounded-xl",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"المجموع الفرعي:"}),e.jsxs("span",{children:[i.toFixed(2)," ر.س"]})]}),a>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"الخصم:"}),e.jsxs("span",{children:["- ",a.toFixed(2)," ر.س"]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"رسوم الفحص:"}),e.jsxs("span",{children:[f.toFixed(2)," ر.س"]})]}),v&&e.jsx("p",{className:"text-red-500 text-xs text-right",children:v}),e.jsxs("div",{className:"flex justify-between font-bold text-lg text-babyJanaBlue pt-2 border-t",children:[e.jsx("span",{children:"المجموع:"}),e.jsxs("span",{children:[F.toFixed(2)," ر.س"]})]})]}),k&&e.jsx("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg text-sm",children:k}),e.jsx(M,{onClick:T,disabled:w,className:"w-full py-3 text-sm font-medium rounded-xl disabled:opacity-50 disabled:cursor-not-allowed",children:w?"جاري المعالجة...":"اتمام الشراء"})]})]})})},P=()=>{const[l,s]=r.useState(!1),{cartItems:x}=z(),i=x.reduce((c,a)=>c+a.quantity,0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>s(!0),className:"p-2  text-gray-400 hover:text-white cursor-pointer",children:e.jsx(W,{className:"w-6 h-6"})}),i>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:i})]}),l&&e.jsx(G,{onClose:()=>s(!1)})]})},oe=()=>{const l=X(),s=O(),[x,i]=r.useState(null);r.useEffect(()=>{const a=localStorage.getItem("userRole");i(a)},[]);const c=a=>{if(a.preventDefault(),!localStorage.getItem("userRole")){s("/login");return}s("/user/profile")};return e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"hidden md:flex fixed justify-between bg-gradient-to-b from-gray-900 to-gray-800 items-center top-0 left-0 right-0 w-full px-6 py-4 z-40 border-b border-gray-700",children:[e.jsx("div",{className:"w-[144px]"}),x?e.jsx(g,{to:"/user",className:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx("img",{src:R,alt:"Khaliji Logo",className:"h-16 w-auto transition-all hover:scale-105 hover:brightness-110 filter drop-shadow-[0_0_8px_rgba(255,255,255,0.15)]"})}):e.jsx(g,{to:"/",className:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2",children:e.jsx("img",{src:R,alt:"Khaliji Logo",className:"h-16 w-auto transition-all hover:scale-105 hover:brightness-110 filter drop-shadow-[0_0_8px_rgba(255,255,255,0.15)]"})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>s("/search"),className:"text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:e.jsx(B,{className:"w-6 h-6"})}),e.jsx("div",{className:"text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:e.jsx(P,{})}),e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:e.jsx(_,{className:"w-6 h-6"})}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:e.jsx(L,{className:"w-6 h-6"})})]})]}),e.jsx("nav",{className:"md:hidden fixed bottom-0 left-0 right-0 w-full shadow-lg border-t border-gray-700 z-50 bg-gradient-to-t from-gray-900 to-gray-800",children:e.jsxs("div",{className:"flex justify-around items-center h-16",children:[e.jsxs(g,{to:"/",className:"flex flex-col items-center text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:[e.jsx($,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"الرئيسية"})]}),e.jsxs("button",{onClick:()=>s("/search"),className:"flex flex-col items-center text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:[e.jsx(B,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"المنتجات"})]}),e.jsxs("div",{className:"flex flex-col items-center text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:[e.jsx(P,{}),e.jsx("span",{className:"text-xs mt-1",children:"السلة"})]}),e.jsxs("button",{onClick:c,className:"flex flex-col items-center text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:[e.jsx(_,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"حسابي"})]}),e.jsxs("button",{onClick:l,className:"flex flex-col items-center text-gray-400 hover:text-white transition-colors p-2 cursor-pointer",children:[e.jsx(L,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"تسجيل خروج"})]})]})})]})};export{oe as default};
