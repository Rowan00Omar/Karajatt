import{r as o,a as D,j as e}from"./index-Bcnj4llk.js";import{H as k}from"./Helmet-ZKerEnO8.js";import{C as A}from"./calendar-_Le0-wA2.js";import{D as E}from"./dollar-sign-BdXO1sqa.js";import{P as F}from"./package-CABj1wkn.js";import{T as C}from"./trending-up-BpKyUX82.js";import{R as L,C as R,X as Y,Y as O,T as G}from"./generateCategoricalChart-hDyQSAj_.js";import{A as P,a as T}from"./AreaChart-o4pT14bF.js";import"./createLucideIcon-Bk6MJNge.js";import"./clsx-B-dksMZM.js";import"./tiny-invariant-CopsF_GD.js";function J(){const[r,u]=o.useState({totalOrders:0,orderGrowth:"0%",salesData:[]}),[f,d]=o.useState(!0),[c,x]=o.useState(null),[l,b]=o.useState(new Date().getFullYear());o.useEffect(()=>{y()},[l]);const y=async()=>{var t,s;try{const a=localStorage.getItem("token");if(!a){x("No authentication token found. Please log in."),d(!1);return}const n=await D.get("/api/admin/stats/sales",{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(n.data){const g=[];for(let i=1;i<=12;i++){const N=i.toString().padStart(2,"0"),w=`${l}-${N}-01`,p=(n.data.salesData||[]).find(S=>{const j=new Date(S.name);return j.getMonth()===i-1&&j.getFullYear()===l});g.push({name:w,value:p&&Number(p.value)||0})}u({totalOrders:n.data.totalOrders||0,orderGrowth:n.data.orderGrowth||"0%",salesData:g})}d(!1)}catch(a){console.error("Error fetching dashboard data:",a),x(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to fetch dashboard data. Please check your connection and try again."),d(!1)}},m=r.salesData.reduce((t,s)=>t+(s.value||0),0),h=r.salesData.filter(t=>t.value>0).length,v=h>0?m/h:0;return f?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):c?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsxs("div",{className:"text-red-600 text-center",children:[e.jsx("p",{className:"text-xl font-semibold mb-2",children:"خطأ"}),e.jsx("p",{children:c})]})}):e.jsxs(e.Fragment,{children:[e.jsx(k,{children:e.jsx("title",{children:"المبيعات والطلبات"})}),e.jsxs("div",{className:"animate-fadeIn p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"المبيعات والطلبات"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"تحليل أداء المبيعات والإيرادات"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg border border-gray-200 px-3 py-2",children:[e.jsx(A,{className:"h-5 w-5 text-gray-400"}),e.jsx("select",{value:l,onChange:t=>b(Number(t.target.value)),className:"border-0 py-1 text-gray-900 focus:ring-0 text-sm",children:[...Array(5)].map((t,s)=>{const a=new Date().getFullYear()-s;return e.jsx("option",{value:a,children:a},a)})})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3 mb-8",children:[e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-indigo-50 rounded-lg",children:e.jsx(E,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"إجمالي الإيرادات"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[m.toLocaleString("ar-SA")," ر.س"]})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-50 rounded-lg",children:e.jsx(F,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"إجمالي الطلبات"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.totalOrders.toLocaleString("ar-SA")})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-yellow-50 rounded-lg",children:e.jsx(C,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"متوسط الإيرادات"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[v.toLocaleString("ar-SA")," ر.س"]})]})]})})]}),r.salesData.length>0&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:"الإيرادات الشهرية"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(L,{width:"100%",height:"100%",children:e.jsxs(P,{data:r.salesData,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#4F46E5",stopOpacity:.1}),e.jsx("stop",{offset:"95%",stopColor:"#4F46E5",stopOpacity:0})]})}),e.jsx(R,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),e.jsx(Y,{dataKey:"name",tickFormatter:t=>new Date(t).toLocaleDateString("ar",{month:"short"}),stroke:"#6B7280"}),e.jsx(O,{stroke:"#6B7280",tickFormatter:t=>`${t.toLocaleString("ar-SA")} ر.س`}),e.jsx(G,{formatter:t=>[`${t.toLocaleString("ar-SA")} ر.س`,"الإيرادات"],labelFormatter:t=>new Date(t).toLocaleDateString("ar",{year:"numeric",month:"long"}),contentStyle:{textAlign:"right",direction:"rtl"}}),e.jsx(T,{type:"monotone",dataKey:"value",stroke:"#4F46E5",strokeWidth:2,fill:"url(#colorRevenue)"})]})})})]}),r.salesData.length===0&&e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"لا توجد بيانات متاحة للفترة المحددة"})})})]})]})}export{J as default};
