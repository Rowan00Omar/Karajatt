import{r,a as d,j as t}from"./index-TKQo8E9Y.js";import{S as j}from"./star-D5X83Bvp.js";const P=({type:n,id:o})=>{const[x,w]=r.useState([]),[l,u]=r.useState({rating:5,comment:"",product_id:null}),[b,h]=r.useState(!0),[p,i]=r.useState(null),[y,N]=r.useState(!1),[g,S]=r.useState(0),[z,_]=r.useState(null),[R,k]=r.useState([]),[f,$]=r.useState(null);r.useEffect(()=>{v(),n==="seller"&&E(),A()},[n,o]);const A=async()=>{const e=localStorage.getItem("token");if(e)try{const s=await d.get("/api/auth/userInfo",{headers:{Authorization:`Bearer ${e}`}});$(s.data.role)}catch(s){console.error("Error fetching user role:",s)}},E=async()=>{try{const e=await d.get(`/api/seller/profile/${o}`);k(e.data.products||[])}catch(e){console.error("Error fetching seller products:",e)}},v=async()=>{try{h(!0);const e=n==="product"?`/api/reviews/product/${o}`:`/api/reviews/seller/${o}`,s=await d.get(e);w(s.data.reviews),S(s.data.average_rating);const c=localStorage.getItem("token");if(c){const m=(await d.get("/api/auth/userInfo",{headers:{Authorization:`Bearer ${c}`}})).data.id;_(m);const U=s.data.reviews.some(C=>C.user_id===m);N(U)}}catch(e){i("Failed to load reviews"),console.error("Error fetching reviews:",e)}finally{h(!1)}},I=async e=>{var s,c;e.preventDefault();try{const a=localStorage.getItem("token");if(!a){i("يرجى تسجيل الدخول لإضافة تقييم");return}if(f!=="user"){i("فقط المستخدمين يمكنهم إضافة تقييمات");return}if(n==="seller"&&!l.product_id){i("يرجى اختيار المنتج للتقييم");return}const m=n==="product"?`/api/reviews/product/${o}`:`/api/reviews/seller/${o}`;await d.post(m,l,{headers:{Authorization:`Bearer ${a}`}}),v(),u({rating:5,comment:"",product_id:null})}catch(a){i(((c=(s=a.response)==null?void 0:s.data)==null?void 0:c.message)||"فشل في إرسال التقييم"),console.error("Error submitting review:",a)}};return b?t.jsx("div",{className:"text-center py-4",children:"جاري التحميل..."}):p?t.jsx("div",{className:"text-red-500 text-center py-4",children:p}):t.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",dir:"rtl",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsxs("h2",{className:"text-xl font-bold text-blue-900",children:["التقييمات والمراجعات (",x.length,")"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex items-center",children:[...Array(5)].map((e,s)=>t.jsx(j,{className:`w-5 h-5 ${s<Math.round(g)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},s))}),t.jsxs("span",{className:"text-sm text-gray-600",children:["(",g," من 5)"]})]})]}),t.jsx("div",{className:"space-y-4 mb-6",children:x.map(e=>{var s;return t.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm",children:(s=e.reviewer_name)==null?void 0:s.charAt(0)}),t.jsxs("div",{children:[t.jsx("span",{className:"font-medium block",children:e.reviewer_name}),e.product_title&&t.jsxs("span",{className:"text-sm text-gray-500",children:["منتج: ",e.product_title]})]})]}),t.jsx("div",{className:"flex items-center",children:[...Array(5)].map((c,a)=>t.jsx(j,{className:`w-4 h-4 ${a<e.rating?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},a))})]}),t.jsx("p",{className:"text-gray-700",children:e.comment}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Date(e.created_at).toLocaleDateString("ar-SA")})]},e.review_id)})}),!y&&f==="user"&&t.jsxs("form",{onSubmit:I,className:"space-y-4",children:[n==="seller"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"اختر المنتج"}),t.jsxs("select",{value:l.product_id||"",onChange:e=>u({...l,product_id:e.target.value}),className:"w-full p-2 border rounded-md",required:!0,children:[t.jsx("option",{value:"",children:"اختر المنتج"}),R.map(e=>t.jsx("option",{value:e.product_id,children:e.title||e.part_name},e.product_id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"التقييم"}),t.jsx("select",{value:l.rating,onChange:e=>u({...l,rating:Number(e.target.value)}),className:"w-full p-2 border rounded-md",children:[5,4,3,2,1].map(e=>t.jsxs("option",{value:e,children:[e," ",e===1?"نجمة":"نجوم"]},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"تعليقك"}),t.jsx("textarea",{value:l.comment,onChange:e=>u({...l,comment:e.target.value}),required:!0,rows:"3",className:"w-full p-2 border rounded-md",placeholder:"اكتب تعليقك هنا..."})]}),t.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors",children:"إرسال التقييم"})]})]})};export{P as R};
