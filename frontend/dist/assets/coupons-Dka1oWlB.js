import{r as i,a as d,j as e,y as p}from"./index-CUFY-AzF.js";import{H as S}from"./Helmet-D2rBKH-8.js";import{P as D}from"./plus-854v7ps2.js";import{c as E}from"./createLucideIcon-CE2DkWhp.js";import{T as I}from"./trash-2-CbAFo3O3.js";/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],z=E("pen",$);function q(){const[f,j]=i.useState([]),[b,y]=i.useState(!0),[u,N]=i.useState(null),[v,l]=i.useState(!1),[c,h]=i.useState(null),[r,o]=i.useState({code:"",discount_percentage:"",expiry_date:"",is_active:!0});i.useEffect(()=>{x()},[]);const x=async()=>{var t,s;try{const a=localStorage.getItem("token"),n=await d.get("/api/coupons",{headers:{Authorization:`Bearer ${a}`}});j(n.data)}catch(a){console.error("Error fetching coupons:",a),N(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to fetch coupons")}finally{y(!1)}},w=async t=>{var s,a;t.preventDefault();try{const n=localStorage.getItem("token");c?await d.put(`/api/coupons/${c.id}`,r,{headers:{Authorization:`Bearer ${n}`}}):await d.post("/api/coupons",r,{headers:{Authorization:`Bearer ${n}`}}),x(),l(!1),m()}catch(n){p.error(((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to save coupon")}},_=async t=>{var s,a;if(confirm("هل أنت متأكد من حذف هذا الكوبون؟"))try{const n=localStorage.getItem("token");await d.delete(`/api/coupons/${t}`,{headers:{Authorization:`Bearer ${n}`}}),x()}catch(n){p.error(((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to delete coupon")}},k=t=>{h(t),o({code:t.code,discount_percentage:t.discount_percentage,expiry_date:new Date(t.expiry_date).toISOString().split("T")[0],is_active:t.is_active}),l(!0)},m=()=>{o({code:"",discount_percentage:"",expiry_date:"",is_active:!0}),h(null)},C=t=>{const s=new Date;return s.setHours(0,0,0,0),new Date(t)<s},g=t=>t.is_active?C(t.expiry_date)?{text:"منتهي الصلاحية",className:"bg-gray-100 text-gray-800"}:{text:"نشط",className:"bg-green-100 text-green-800"}:{text:"غير نشط",className:"bg-red-100 text-red-800"};return b?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):u?e.jsxs("div",{className:"text-red-600 text-center",children:[e.jsx("p",{className:"text-xl font-semibold mb-2",children:"خطأ"}),e.jsx("p",{children:u})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsx("title",{children:"إدارة الكوبونات"})}),e.jsxs("section",{className:"w-full animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold",children:"إدارة الكوبونات"}),e.jsxs("button",{onClick:()=>{m(),l(!0)},className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(D,{className:"h-5 w-5"}),e.jsx("span",{children:"إضافة كوبون"})]})]}),e.jsx("div",{className:"grid gap-4",children:f.map(t=>e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:t.code}),e.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:["خصم ",t.discount_percentage,"%"]}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["ينتهي في:"," ",new Date(t.expiry_date).toLocaleDateString("ar",{year:"numeric",month:"long",day:"numeric",calendar:"gregory"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${g(t).className}`,children:g(t).text}),e.jsx("button",{onClick:()=>k(t),className:"text-blue-500 hover:text-blue-600 transition-colors",children:e.jsx(z,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>_(t.id),className:"text-red-500 hover:text-red-600 transition-colors",children:e.jsx(I,{className:"h-5 w-5"})})]})]})},t.id))}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:c?"تعديل كوبون":"إضافة كوبون جديد"}),e.jsx("button",{onClick:()=>{l(!1),m()},className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رمز الكوبون"}),e.jsx("input",{type:"text",value:r.code,onChange:t=>o({...r,code:t.target.value}),className:"w-full p-2 border rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"نسبة الخصم (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:r.discount_percentage,onChange:t=>o({...r,discount_percentage:t.target.value}),className:"w-full p-2 border rounded-lg",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"تاريخ الانتهاء"}),e.jsx("input",{type:"date",value:r.expiry_date,onChange:t=>o({...r,expiry_date:t.target.value}),className:"w-full p-2 border rounded-lg",required:!0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.is_active,onChange:t=>o({...r,is_active:t.target.checked}),className:"rounded text-indigo-600"}),e.jsx("label",{className:"text-sm text-gray-700",children:"نشط"})]}),e.jsx("button",{type:"submit",className:"w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition-colors",children:c?"تحديث":"إضافة"})]})]})})]})]})}export{q as default};
