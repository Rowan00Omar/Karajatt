import{c as S,u as I,r as c,j as e,a as v}from"./index-TKQo8E9Y.js";import{I as o}from"./Input-GBTnebKl.js";import{B as k}from"./Button-Bz5t1SZd.js";import{H as q}from"./Helmet-sj4pvQPj.js";import{X as E}from"./x-DUplZ4HW.js";import{c as B}from"./createLucideIcon-KWJgnnEM.js";/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],A=B("arrow-right",U),$=()=>{const d=S(),_=I(),[p,g]=c.useState(!1),[f,y]=c.useState(""),[R,N]=c.useState(null),[a,x]=c.useState({first_name:"",last_name:"",email:"",phone_number:"",apartment:"",floor:"",street:"",building:"",shipping_method:"PKG",postal_code:"",city:"Riyadh",country:"SA",state:"Riyadh"});c.useEffect(()=>{(async()=>{try{const s=localStorage.getItem("token");if(!s){d("/login");return}const r=await v.get("/api/auth/userInfo",{headers:{Authorization:`Bearer ${s}`}});N(r.data),x(t=>({...t,first_name:r.data.first_name||"",last_name:r.data.last_name||"",email:r.data.email||"",phone_number:r.data.phone_number||""}))}catch{d("/login")}})()},[d]);const n=m=>{const{name:s,value:r}=m.target;if(s==="phone_number"){let t=r.replace(/\D/g,"");t.startsWith("966")||(t.startsWith("0")&&(t=t.substring(1)),t.startsWith("966")||(t="+966"+t)),x(h=>({...h,[s]:t}))}else x(t=>({...t,[s]:r}))},w=async m=>{var s,r,t,h,b;m.preventDefault(),g(!0),y("");try{const l=localStorage.getItem("token");let u=(s=_.state)==null?void 0:s.cartData;if(!u){const j=localStorage.getItem("checkoutCartData");j&&(u=JSON.parse(j))}if(!u)throw new Error("لم يتم العثور على بيانات السلة");const D={...a,phone_number:a.phone_number.startsWith("+966")?a.phone_number:"+966"+a.phone_number},i=await v.post("/api/payments/checkout",{...u,billingData:D},{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}});if(i.data.success&&i.data.paymentUrl)localStorage.setItem("currentOrderId",i.data.orderId),window.location.href=i.data.paymentUrl;else throw new Error(i.data.error||"فشل في بدء عملية الدفع")}catch(l){console.error("خطأ في الدفع:",{error:((t=(r=l.response)==null?void 0:r.data)==null?void 0:t.error)||l.message,timestamp:new Date().toISOString()}),y(((b=(h=l.response)==null?void 0:h.data)==null?void 0:b.error)||l.message||"حدث خطأ")}finally{g(!1)}},C=()=>{d(-1)};return e.jsxs(e.Fragment,{children:[e.jsx(q,{children:e.jsx("title",{children:"الفاتورة"})}),e.jsx("div",{className:"fixed inset-0 flex flex-col justify-center items-center bg-gray-900/30 backdrop-blur-md px-4 py-12 sm:px-6 lg:px-8",children:e.jsx("div",{className:"w-full max-w-2xl relative",children:e.jsxs("div",{className:"bg-white py-8 px-4 shadow-2xl sm:rounded-2xl sm:px-10",children:[e.jsx("button",{onClick:C,className:"absolute top-4 left-4 text-gray-400 hover:text-gray-500 transition-colors",children:e.jsx(E,{className:"w-6 h-6"})}),e.jsxs("form",{onSubmit:w,className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"معلومات الفواتير"}),e.jsx("p",{className:"text-gray-600",children:"يرجى إدخال معلومات الفواتير الخاصة بك للمتابعة"})]}),f&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg",children:f}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"المعلومات الشخصية"}),e.jsx(o,{type:"text",name:"first_name",placeholder:"الاسم الأول",value:a.first_name,onChange:n,required:!0}),e.jsx(o,{type:"text",name:"last_name",placeholder:"الاسم الأخير",value:a.last_name,onChange:n,required:!0}),e.jsx(o,{type:"email",name:"email",placeholder:"البريد الإلكتروني",value:a.email,onChange:n,required:!0}),e.jsx(o,{type:"tel",name:"phone_number",placeholder:"رقم الهاتف",value:a.phone_number,onChange:n,required:!0}),e.jsx("p",{className:"text-sm text-gray-500",children:"سيتم إضافة رمز الدولة +966 تلقائياً"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"معلومات العنوان"}),e.jsx(o,{type:"text",name:"street",placeholder:"الشارع",value:a.street,onChange:n,required:!0}),e.jsx(o,{type:"text",name:"building",placeholder:"رقم المبنى",value:a.building,onChange:n,required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{type:"text",name:"apartment",placeholder:"الشقة",value:a.apartment,onChange:n,required:!0}),e.jsx(o,{type:"text",name:"floor",placeholder:"الطابق",value:a.floor,onChange:n,required:!0})]}),e.jsx(o,{type:"text",name:"postal_code",placeholder:"الرمز البريدي",value:a.postal_code,onChange:n,required:!0})]})]}),e.jsxs(k,{type:"submit",className:"w-full flex justify-center items-center gap-2 py-3 px-4 border border-transparent rounded-lg shadow-sm text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors",disabled:p,children:[p?"جاري المعالجة...":"المتابعة إلى الدفع",!p&&e.jsx(A,{className:"w-5 h-5"})]})]})]})})})]})};export{$ as default};
