import{r as c,a as I,j as e}from"./index-CUFY-AzF.js";import{H as T}from"./Helmet-D2rBKH-8.js";import{C as B}from"./calendar-DbUtPyaZ.js";import{U as G}from"./users-BCzJI8JI.js";import{c as R}from"./createLucideIcon-CE2DkWhp.js";import{S as L}from"./search-Dsg8pXzC.js";import{R as v,C as b,X as w,Y as D,T as k}from"./generateCategoricalChart-7M0Bs09o.js";import{A as S,a as F}from"./AreaChart-BUCU2hj-.js";import"./clsx-B-dksMZM.js";import"./tiny-invariant-CopsF_GD.js";/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],P=R("user-check",Y);function z(){const[n,A]=c.useState({totalUsers:0,activeUsers:0,userGrowth:"0%",activeGrowth:"0%",registrationData:[],searchData:[],visitData:[]}),[E,d]=c.useState(!0),[x,h]=c.useState(null),[o,U]=c.useState(new Date().getFullYear());c.useEffect(()=>{g();const t=setInterval(()=>{g()},3e4);return()=>clearInterval(t)},[o]);const g=async()=>{var t,r;try{const a=localStorage.getItem("token");if(!a){h("No authentication token found. Please log in."),d(!1);return}const p=`/api/admin/stats/users?year=${o}`;console.log("Fetching data for year:",o),console.log("API URL:",p),console.log("Token:",a?"Present":"Missing");const s=await I.get(p,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(console.log("API Response:",s.data),s.data){const u=[],j=[];for(let i=1;i<=12;i++){const C=i.toString().padStart(2,"0"),f=`${o}-${C}-01`,y=(s.data.registrationData||[]).find(m=>{const l=new Date(m.name);return l.getMonth()===i-1&&l.getFullYear()===o}),N=(s.data.visitData||[]).find(m=>{const l=new Date(m.name);return l.getMonth()===i-1&&l.getFullYear()===o});u.push({name:f,value:y&&Number(y.value)||0}),j.push({name:f,value:N&&Number(N.value)||0})}A({totalUsers:s.data.totalUsers||0,activeUsers:s.data.activeUsers||0,userGrowth:s.data.userGrowth||"0%",activeGrowth:s.data.activeGrowth||"0%",registrationData:u,visitData:j})}d(!1)}catch(a){console.error("Error fetching dashboard data:",a),a.response&&(console.log("Error Response:",a.response.data),console.log("Error Status:",a.response.status)),h(((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to fetch dashboard data. Please check your connection and try again."),d(!1)}};return E?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):x?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsxs("div",{className:"text-red-600 text-center",children:[e.jsx("p",{className:"text-xl font-semibold mb-2",children:"خطأ"}),e.jsx("p",{children:x})]})}):e.jsxs(e.Fragment,{children:[e.jsx(T,{children:e.jsx("title",{children:"المستخدمون والسلوك"})}),e.jsxs("div",{className:"animate-fadeIn p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"المستخدمون والسلوك"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"تحليل نشاط وسلوك المستخدمين"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg border border-gray-200 px-3 py-2",children:[e.jsx(B,{className:"h-5 w-5 text-gray-400"}),e.jsx("select",{value:o,onChange:t=>U(Number(t.target.value)),className:"border-0 py-1 text-gray-900 focus:ring-0 text-sm",children:[...Array(5)].map((t,r)=>{const a=new Date().getFullYear()-r;return e.jsx("option",{value:a,children:a},a)})})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3 mb-8",children:[e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-indigo-50 rounded-lg",children:e.jsx(G,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"إجمالي المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.totalUsers.toLocaleString("ar-SA")})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-50 rounded-lg",children:e.jsx(P,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"المستخدمين النشطين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.activeUsers.toLocaleString("ar-SA")})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-yellow-50 rounded-lg",children:e.jsx(L,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"نمو المستخدمين"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.userGrowth})]})]})})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 mb-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:"التسجيلات الجديدة"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(S,{data:n.registrationData,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRegistrations",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#4F46E5",stopOpacity:.1}),e.jsx("stop",{offset:"95%",stopColor:"#4F46E5",stopOpacity:0})]})}),e.jsx(b,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),e.jsx(w,{dataKey:"name",tickFormatter:t=>{try{const r=new Date(t);return isNaN(r.getTime())?t:new Intl.DateTimeFormat("ar",{month:"long",calendar:"gregory"}).format(r)}catch(r){return console.error("Date parsing error:",r),t}},stroke:"#6B7280"}),e.jsx(D,{stroke:"#6B7280",tickFormatter:t=>t.toLocaleString("ar-SA")}),e.jsx(k,{formatter:t=>[t.toLocaleString("ar-SA"),"التسجيلات"],labelFormatter:t=>{try{const r=new Date(t);return isNaN(r.getTime())?t:new Intl.DateTimeFormat("ar",{year:"numeric",month:"long",calendar:"gregory"}).format(r)}catch(r){return console.error("Date parsing error:",r),t}},contentStyle:{textAlign:"right",direction:"rtl"}}),e.jsx(F,{type:"monotone",dataKey:"value",stroke:"#4F46E5",strokeWidth:2,fill:"url(#colorRegistrations)"})]})})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold mb-6",children:"الزيارات الشهرية"}),e.jsx("div",{className:"h-[300px]",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(S,{data:n.visitData,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorVisits",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10B981",stopOpacity:.1}),e.jsx("stop",{offset:"95%",stopColor:"#10B981",stopOpacity:0})]})}),e.jsx(b,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),e.jsx(w,{dataKey:"name",tickFormatter:t=>{try{const r=new Date(t);return isNaN(r.getTime())?t:new Intl.DateTimeFormat("ar",{month:"long",calendar:"gregory"}).format(r)}catch(r){return console.error("Date parsing error:",r),t}},stroke:"#6B7280"}),e.jsx(D,{stroke:"#6B7280",tickFormatter:t=>t.toLocaleString("ar-SA")}),e.jsx(k,{formatter:t=>[t.toLocaleString("ar-SA"),"الزيارات"],labelFormatter:t=>{try{const r=new Date(t);return isNaN(r.getTime())?t:new Intl.DateTimeFormat("ar",{year:"numeric",month:"long",calendar:"gregory"}).format(r)}catch(r){return console.error("Date parsing error:",r),t}},contentStyle:{textAlign:"right",direction:"rtl"}}),e.jsx(F,{type:"monotone",dataKey:"value",stroke:"#10B981",strokeWidth:2,fill:"url(#colorVisits)"})]})})})]})]})]})]})}export{z as default};
