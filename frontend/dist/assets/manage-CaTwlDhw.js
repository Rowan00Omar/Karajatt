import{r,a as u,j as e,y as f}from"./index-BEGJQ63u.js";import{U as S,P as _,S as F}from"./Signup-0seX2oWb.js";import{H as R}from"./Helmet-Dzy0pJPU.js";import{T as H}from"./trash-2-BnClhVmk.js";import"./Input-Nh2kS7_N.js";import"./Button-Ws8jbhJw.js";import"./createLucideIcon-D7XQlGWz.js";function V(){const[p,U]=r.useState([]),[a,o]=r.useState(1),[I,b]=r.useState(!0),[j,d]=r.useState(null),[P,c]=r.useState(!1),[x,$]=r.useState("all"),[y,A]=r.useState(null),[D,m]=r.useState(!1),[E,N]=r.useState(null),h=8;r.useEffect(()=>{g(),M()},[]);const M=async()=>{const s=localStorage.getItem("token");if(s)try{const t=await u.get("/api/auth/userInfo",{headers:{Authorization:`Bearer ${s}`}});A(t.data.id)}catch(t){console.error("Error fetching current user ID:",t)}},g=async()=>{var t,n,C;const s=localStorage.getItem("token");if(!s){d("No authentication token found. Please log in."),b(!1);return}try{const i=await u.get("/api/auth/users",{headers:{Authorization:`Bearer ${s}`}});(t=i.data)!=null&&t.users?U(i.data.users):d("No users data received")}catch(i){console.error("Error fetching users:",i),d(((C=(n=i.response)==null?void 0:n.data)==null?void 0:C.message)||"Failed to fetch users list")}finally{b(!1)}},z=s=>{if(s===y){f.error("لا يمكنك حذف حسابك الخاص.");return}N(s),m(!0)},L=async()=>{var s,t;m(!1);try{const n=localStorage.getItem("token");await u.delete(`/api/auth/users/${E}`,{headers:{Authorization:`Bearer ${n}`}}),f.success("تم حذف المستخدم بنجاح."),g()}catch(n){console.error("Delete failed:",n),f.error(((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to delete user")}},B=()=>{m(!1),N(null)},v=()=>{c(!0)},w=p.filter(s=>x==="all"?!0:s.role===x),k=a*h,T=w.slice(k-h,k),l=Math.ceil(w.length/h);return I?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):j?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsxs("div",{className:"text-red-600 text-center",children:[e.jsx("p",{className:"text-xl font-semibold mb-2",children:"خطأ"}),e.jsx("p",{children:j})]})}):p.length?e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsx("title",{children:"إدارة المستخدمين"})}),e.jsxs("section",{className:"w-full animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold",children:"إدارة المستخدمين"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:x,onChange:s=>{$(s.target.value),o(1)},className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"all",children:"جميع المستخدمين"}),e.jsx("option",{value:"admin",children:"المشرفين"}),e.jsx("option",{value:"seller",children:"البائعين"}),e.jsx("option",{value:"user",children:"المستخدمين"})]})})]}),e.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(S,{className:"h-5 w-5"}),e.jsx("span",{children:"إضافة مستخدم"})]})]}),e.jsx("div",{className:"grid gap-4",children:T.map(s=>s.role==="master"?null:e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:[s.first_name||"مستخدم بدون اسم"," ",s.last_name]}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:s.email||"لا يوجد بريد إلكتروني"}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx(_,{className:"w-4 h-4 ml-1"}),s.phone_number||"لا يوجد رقم هاتف"]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${s.role==="admin"?"bg-indigo-100 text-indigo-800":s.role==="seller"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:s.role==="admin"?"مشرف":s.role==="seller"?"بائع":"مستخدم"}),s.id!==y&&e.jsx("button",{onClick:()=>z(s.id),className:"text-red-500 hover:text-red-600 transition-colors",children:e.jsx(H,{className:"h-5 w-5"})})]})]})},s.id))}),l>1&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-6",children:[e.jsx("button",{onClick:()=>o(s=>Math.max(s-1,1)),disabled:a===1,className:`px-4 py-2 rounded-lg transition-colors font-bold ${a===1?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"السابق"}),Array.from({length:l},(s,t)=>e.jsx("button",{onClick:()=>o(t+1),className:`px-4 py-2 rounded-lg transition-colors ${a===t+1?"bg-indigo-600 text-white font-bold":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:t+1},t)),e.jsx("button",{onClick:()=>o(s=>Math.min(s+1,l)),disabled:a===l,className:`px-4 py-2 rounded-lg transition-colors font-bold ${a===l?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,children:"التالي"})]})]}),P&&e.jsx("div",{className:"fixed inset-0 z-[9999] overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-white/30 backdrop-blur-sm transition-opacity",onClick:()=>c(!1)}),e.jsx("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),e.jsx("div",{className:"relative inline-block transform overflow-hidden rounded-lg bg-white text-right align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-2xl sm:align-middle",children:e.jsxs("div",{className:"bg-white px-6 py-8",children:[e.jsx("div",{className:"border-b border-gray-200 pb-6 mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"إضافة مستخدم جديد"}),e.jsx("button",{onClick:()=>c(!1),className:"text-gray-400 hover:text-gray-500 transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx(F,{flag:!0,onSuccess:()=>{c(!1),g()}})]})})]})}),D&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/30 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-sm w-full text-center",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"تأكيد حذف المستخدم"}),e.jsx("p",{className:"mb-6",children:"هل أنت متأكد أنك تريد حذف هذا المستخدم؟ لا يمكن التراجع عن هذا الإجراء."}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:L,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"حذف"}),e.jsx("button",{onClick:B,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"إلغاء"})]})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"لا يوجد مستخدمين حالياً"}),e.jsxs("button",{onClick:v,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(S,{className:"h-5 w-5"}),e.jsx("span",{children:"إضافة مستخدم"})]})]})}export{V as default};
